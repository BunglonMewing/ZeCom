<!DOCTYPE html>
<html lang="id">
<head>
    <link rel="manifest" href="/site.webmanifest">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ZenCom adalah web komunitas yang Berfokus Membagikan Sticker Meme, Atau Foto apapun, AYO POSTING DI ZENCOM!...">
    <title>ZenCom - Komunitas Zen</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Header Styles */
        header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 50;
        }

        .header-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 4rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Button Styles */
        .zen-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            font-size: 0.875rem;
        }

        .zen-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .zen-button:active {
            transform: translateY(0);
        }

        /* Main Container */
        .main-container {
            max-width: 1280px;
            margin: 0 auto;
            margin-top: 4rem;
            padding: 0 1rem;
            display: flex;
            gap: 1rem;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 16rem;
            padding: 1rem;
            display: none;
        }

        @media (min-width: 1024px) {
            .sidebar {
                display: block;
            }
        }

        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #4b5563;
            padding: 0.75rem;
            border-radius: 1rem;
            text-decoration: none;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.8);
        }

        .nav-icon {
            font-size: 1.25rem;
            color: #667eea;
        }

        .nav-text {
            font-weight: 500;
        }

        /* User Card */
        .user-card {
            margin-top: 2rem;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 1rem;
            display: none;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .user-details h4 {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .user-details p {
            color: #6b7280;
            font-size: 0.75rem;
        }

        .user-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 0.75rem;
            text-align: center;
        }

        .stat {
            flex: 1;
        }

        .stat-number {
            font-weight: 600;
            display: block;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.75rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 1.5rem 1rem;
        }

        .feed-header {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .feed-title {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Create Post Section */
        .create-post {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 1.25rem;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: none;
        }

        .create-post:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .post-form {
            display: flex;
            gap: 1rem;
        }

        .post-avatar {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .post-input-container {
            flex: 1;
        }

        .post-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 0.75rem;
            padding: 0.75rem;
            resize: none;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 1rem;
        }

        .post-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .post-tools {
            display: flex;
            gap: 0.75rem;
        }

        .tool-button {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tool-button:hover {
            background: white;
            transform: scale(1.05);
        }

        .tool-icon {
            color: #667eea;
        }

        /* Posts Feed */
        .posts-feed {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .posts-feed::-webkit-scrollbar {
            width: 8px;
        }

        .posts-feed::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .posts-feed::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .posts-feed::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        /* Post Card */
        .zen-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 1.25rem;
            padding: 1.25rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .zen-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .post-header {
            display: flex;
            gap: 1rem;
        }

        .post-avatar-large {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .post-avatar-large:hover {
            transform: scale(1.1);
        }

        .post-meta {
            flex: 1;
        }

        .post-meta-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .post-user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .post-username {
            font-weight: 600;
            color: #1f2937;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .post-username:hover {
            color: #667eea;
        }

        .post-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .post-time {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .post-content {
            color: #374151;
            font-size: 1.125rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-action {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .post-action:hover {
            background: white;
            transform: scale(1.05);
        }

        .post-action.liked {
            background: #ff6b6b;
            color: white;
        }

        .action-icon {
            color: #667eea;
        }

        .post-action.liked .action-icon {
            color: white;
        }

        .action-count {
            font-size: 0.875rem;
        }

        .share-option {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
        }

        .share-option:hover {
            background-color: #f3f4f6;
        }

        /* Right Sidebar */
        .right-sidebar {
            width: 20rem;
            padding: 1rem;
            display: none;
        }

        @media (min-width: 1280px) {
            .right-sidebar {
                display: block;
            }
        }

        .search-box {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .search-input {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .search-input input {
            background: transparent;
            border: none;
            outline: none;
            flex: 1;
            font-family: inherit;
        }

        .sidebar-section {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-weight: bold;
            font-size: 1.125rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .trending-item, .user-suggestion {
            padding: 0.75rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trending-item:hover, .user-suggestion:hover {
            background: rgba(255, 255, 255, 0.8);
        }

        .trending-topic {
            font-weight: 600;
            color: #667eea;
        }

        .trending-count {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .suggested-user {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .user-suggestion-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .suggestion-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .suggestion-details h5 {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .suggestion-details p {
            color: #6b7280;
            font-size: 0.75rem;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            max-width: 28rem;
            width: 100%;
            padding: 2rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-logo-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-logo-text {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-button {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 1.25rem;
            transition: color 0.3s ease;
        }

        .close-button:hover {
            color: #374151;
        }

        .form-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1f2937;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }

        .form-link {
            text-align: center;
            margin-top: 1.5rem;
            color: #6b7280;
        }

        .form-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .form-link a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        /* Post Detail Modal */
        .post-detail-modal .modal-content {
            max-width: 48rem;
            max-height: 90vh;
            overflow-y: auto;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .detail-title {
            font-size: 1.25rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Notification Toast */
        .notification-toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 1rem;
            display: none;
            z-index: 60;
        }

        .notification-toast.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .notification-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .notification-text {
            font-weight: 500;
            color: #1f2937;
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Responsive adjustments */
        @media (max-width: 1023px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar, .right-sidebar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-spa text-white text-xl"></i>
                    </div>
                    <h1 class="logo-text">ZenCom</h1>
                </div>
                <div class="header-actions">
                    <button onclick="showSearch()" class="close-button">
                        <i class="fas fa-search text-xl"></i>
                    </button>
                    <button id="authBtn" onclick="toggleAuth()" class="zen-button">
                        Masuk
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="nav-menu">
                <a href="#" onclick="showFeed()" class="nav-item">
                    <i class="fas fa-home nav-icon"></i>
                    <span class="nav-text">Beranda</span>
                </a>
                <a href="#" onclick="showExplore()" class="nav-item">
                    <i class="fas fa-compass nav-icon"></i>
                    <span class="nav-text">Jelajahi</span>
                </a>
                <a href="#" onclick="showNotifications()" class="nav-item">
                    <i class="fas fa-bell nav-icon"></i>
                    <span class="nav-text">Notifikasi</span>
                    <span id="notifCount" class="bg-red-500 text-white text-xs rounded-full px-2 py-1 hidden">0</span>
                </a>
                <a href="#" onclick="showMessages()" class="nav-item">
                    <i class="fas fa-envelope nav-icon"></i>
                    <span class="nav-text">Pesan</span>
                </a>
                <a href="#" onclick="showProfile()" class="nav-item">
                    <i class="fas fa-user nav-icon"></i>
                    <span class="nav-text">Profil</span>
                </a>
                <button onclick="showCreatePost()" class="zen-button" style="width: 100%; margin-top: 1rem;">
                    <i class="fas fa-plus mr-2"></i>Buat Zen
                </button>
            </nav>
            
            <!-- User Profile Card -->
            <div id="userCard" class="user-card">
                <div class="user-info">
                    <img id="userAvatar" src="https://picsum.photos/seed/user/50/50" alt="User" class="user-avatar">
                    <div class="user-details">
                        <h4 id="userName">User Name</h4>
                        <p id="userHandle">@username</p>
                    </div>
                </div>
                <div class="user-stats">
                    <div class="stat">
                        <span id="userFollowing" class="stat-number">0</span>
                        <span class="stat-label">Mengikuti</span>
                    </div>
                    <div class="stat">
                        <span id="userFollowers" class="stat-number">0</span>
                        <span class="stat-label">Pengikut</span>
                    </div>
                    <div class="stat">
                        <span id="userPosts" class="stat-number">0</span>
                        <span class="stat-label">Zen</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Feed Header -->
            <div class="feed-header">
                <h2 id="feedTitle" class="feed-title">Beranda</h2>
            </div>

            <!-- Create Post -->
            <div id="createPostSection" class="create-post">
                <div class="post-form">
                    <img id="currentUserAvatar" src="https://picsum.photos/seed/currentuser/60/60" alt="User" class="post-avatar">
                    <div class="post-input-container">
                        <textarea id="postContent" placeholder="Bagikan zen Anda..." class="post-textarea" rows="4"></textarea>
                            <input type="file" id="imageUpload" class="hidden" accept="image/*" onchange="handleImageSelection(event)">
                            <img id="imagePreview" src="" alt="Pratinjau Gambar" class="hidden" style="max-width: 100%; border-radius: 0.75rem; margin-top: 1rem;">
                        <div class="post-actions">
                            <div class="post-tools">
                                    <button id="imageUploadBtn" class="tool-button" onclick="document.getElementById('imageUpload').click()">
                                    <i class="fas fa-image tool-icon"></i>
                                </button>
                                <button class="tool-button">
                                    <i class="fas fa-poll tool-icon"></i>
                                </button>
                                <button class="tool-button">
                                    <i class="fas fa-smile tool-icon"></i>
                                </button>
                            </div>
                            <button onclick="createPost()" class="zen-button">
                                <i class="fas fa-spa mr-2"></i>Zen
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Posts Feed -->
            <div id="postsFeed" class="posts-feed">
                <!-- Posts will be dynamically inserted here -->
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <!-- Search -->
            <div class="search-box">
                <div class="search-input">
                    <i class="fas fa-search text-gray-500"></i>
                    <input type="text" id="searchInput" onkeyup="handleSearch()" placeholder="Cari di ZenCom">
                </div>
            </div>

            <!-- Trends -->
            <div class="sidebar-section">
                <h3 class="section-title">Zen Trending</h3>
                <div id="trendingList" class="trending-list">
                    <!-- Trending topics will be dynamically inserted -->
                </div>
            </div>

            <!-- Who to Follow -->
            <div class="sidebar-section">
                <h3 class="section-title">Zen Master</h3>
                <div id="suggestedUsers" class="suggested-users">
                    <!-- Suggested users will be dynamically inserted -->
                </div>
            </div>
        </aside>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-logo">
                    <div class="modal-logo-icon">
                        <i class="fas fa-spa text-white text-2xl"></i>
                    </div>
                    <h2 class="modal-logo-text">ZenCom</h2>
                </div>
                <button onclick="toggleAuth()" class="close-button">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <h3 class="form-title">Masuk ke ZenCom</h3>
                <input type="email" id="loginEmail" placeholder="Email" class="form-input">
                <input type="password" id="loginPassword" placeholder="Password" class="form-input">
                <button onclick="login()" class="zen-button" style="width: 100%;">
                    Masuk
                </button>
                <button onclick="loginWithGitHub()" class="zen-button" style="width: 100%; margin-top: 0.5rem; background: #333;">
                    <i class="fab fa-github"></i> Masuk dengan GitHub
                </button>
                <p class="form-link">
                    Belum punya akun? <a href="#" onclick="showRegister()">Daftar</a>
                </p>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <h3 class="form-title">Buat akun ZenCom</h3>
                <input type="text" id="registerName" placeholder="Nama Lengkap" class="form-input">
                <input type="text" id="registerUsername" placeholder="Username" class="form-input">
                <input type="email" id="registerEmail" placeholder="Email" class="form-input">
                <input type="password" id="registerPassword" placeholder="Password" class="form-input">
                <div style="display: flex; align-items: center; margin-bottom: 1rem; gap: 0.5rem;">
                    <input type="checkbox" id="termsCheckbox" style="width: 1rem; height: 1rem;">
                    <label for="termsCheckbox" style="font-size: 0.875rem; color: #4b5563;">
                        Saya setuju dengan <a href="#" onclick="event.preventDefault(); toggleTermsModal()" class="form-link" style="display: inline; text-decoration: underline; margin: 0; padding: 0;">Syarat dan Ketentuan</a>
                    </label>
                </div>
                <button onclick="register()" class="zen-button" style="width: 100%;">
                    Daftar
                </button>
                <p class="form-link">
                    Sudah punya akun? <a href="#" onclick="showLogin()">Masuk</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Post Detail Modal -->
    <div id="postDetailModal" class="modal post-detail-modal">
        <div class="modal-content">
            <div class="detail-header">
                <h3 class="detail-title">Detail Zen</h3>
                <button onclick="closePostDetail()" class="close-button">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="postDetailContent">
                <!-- Post detail will be dynamically inserted -->
            </div>
        </div>
    </div>

    <!-- Image Detail Modal -->
    <div id="imageDetailModal" class="modal" onclick="closeImageDetail()">
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh; padding: 0; background: transparent;">
            <img id="imageDetailContent" src="" style="width: auto; height: auto; max-width: 100%; max-height: 100%; border-radius: 1.5rem;">
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast">
        <div class="notification-content">
            <div class="notification-icon">
                <i class="fas fa-check"></i>
            </div>
            <p id="notificationText" class="notification-text"></p>
        </div>
    </div>

    <!-- Terms and Conditions Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content" style="max-width: 48rem; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-logo-text">Syarat dan Ketentuan</h2>
                <button onclick="toggleTermsModal()" class="close-button">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="terms-content" style="font-size: 0.875rem; color: #374151; line-height: 1.6;">
                <p><strong>Terakhir diperbarui: 29 September 2025</strong></p>
                <br>
                <p>Selamat datang di ZenCom. Terima kasih telah menggunakan layanan kami. Dokumen ini berisi syarat dan ketentuan yang mengatur penggunaan situs dan layanan ZenCom (“kami”, “kita”, atau “platform”). Dengan mengakses atau menggunakan situs https://zencom.netlify.app, Anda (“Pengguna”) dianggap telah membaca, memahami, dan menyetujui seluruh ketentuan yang tercantum di bawah ini.</p>
                <p>Apabila Anda tidak menyetujui sebagian atau seluruh ketentuan dalam dokumen ini, mohon untuk tidak menggunakan layanan ZenCom.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">1. Definisi</h4>
                <p>1.1. <strong>ZenCom</strong> adalah platform komunitas online yang disediakan melalui situs https://zencom.netlify.app.</p>
                <p>1.2. <strong>Pengguna</strong> adalah setiap individu yang mengakses, menggunakan, atau membuat akun di ZenCom.</p>
                <p>1.3. <strong>Konten</strong> mencakup seluruh materi yang diunggah atau dipublikasikan oleh Pengguna, termasuk teks, gambar, tautan, dan bentuk lainnya.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">2. Ketentuan Akun Pengguna</h4>
                <p>2.1. Pengguna dapat membuat akun menggunakan email atau akun GitHub.</p>
                <p>2.2. Pengguna bertanggung jawab penuh terhadap keamanan akun, termasuk kerahasiaan kata sandi dan informasi login.</p>
                <p>2.3. ZenCom tidak bertanggung jawab atas penyalahgunaan akun akibat kelalaian Pengguna.</p>
                <p>2.4. Dilarang membuat akun palsu, meniru identitas orang lain, atau menggunakan informasi yang tidak benar.</p>
                <p>2.5. ZenCom berhak menangguhkan atau menghapus akun yang melanggar ketentuan ini tanpa pemberitahuan terlebih dahulu.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">3. Ketentuan Penggunaan</h4>
                <p>3.1. Pengguna wajib menggunakan layanan ZenCom sesuai dengan ketentuan hukum yang berlaku di Republik Indonesia.</p>
                <p>3.2. Pengguna dilarang mengunggah, memposting, atau membagikan konten yang:</p>
                <ul style="list-style-type: disc; margin-left: 1.5rem;">
                    <li>Mengandung unsur pornografi, kekerasan, atau ujaran kebencian;</li>
                    <li>Melanggar hak cipta, merek dagang, atau hak kekayaan intelektual pihak lain;</li>
                    <li>Menyesatkan, bersifat fitnah, atau mengandung informasi palsu (hoaks);</li>
                    <li>Mengandung unsur diskriminatif terhadap suku, agama, ras, atau golongan tertentu.</li>
                </ul>
                <p>3.3. ZenCom berhak menghapus, memblokir, atau menonaktifkan akses terhadap konten yang dianggap melanggar ketentuan tanpa pemberitahuan.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">4. Kepemilikan dan Penggunaan Konten</h4>
                <p>4.1. Seluruh konten yang diunggah oleh Pengguna tetap menjadi hak milik Pengguna.</p>
                <p>4.2. Dengan mengunggah konten ke ZenCom, Pengguna memberikan lisensi non-eksklusif kepada ZenCom untuk menampilkan, menyimpan, dan mendistribusikan konten tersebut di dalam platform.</p>
                <p>4.3. ZenCom tidak akan menjual atau mendistribusikan konten Pengguna kepada pihak ketiga tanpa izin.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">5. Tanggung Jawab Pengguna</h4>
                <p>5.1. Pengguna bertanggung jawab penuh atas konten yang dipublikasikan melalui akun miliknya.</p>
                <p>5.2. ZenCom tidak bertanggung jawab atas setiap klaim, pelanggaran, atau kerugian yang timbul akibat aktivitas Pengguna.</p>
                <p>5.3. Pengguna wajib menjaga etika dan kesopanan dalam berinteraksi dengan pengguna lain di platform.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">6. Batasan Tanggung Jawab</h4>
                <p>6.1. Layanan ZenCom disediakan dalam kondisi “sebagaimana adanya” (as is) tanpa jaminan apa pun, baik tersurat maupun tersirat.</p>
                <p>6.2. ZenCom tidak menjamin bahwa layanan akan selalu tersedia, bebas gangguan, atau bebas dari kesalahan teknis.</p>
                <p>6.3. ZenCom tidak bertanggung jawab atas kehilangan data, gangguan akses, atau kerugian yang timbul akibat penggunaan layanan.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">7. Perubahan Layanan</h4>
                <p>ZenCom berhak, kapan pun dan dengan alasan apa pun, untuk:</p>
                <ul style="list-style-type: disc; margin-left: 1.5rem;">
                    <li>Mengubah, menangguhkan, atau menghentikan sebagian atau seluruh layanan;</li>
                    <li>Melakukan pembaruan terhadap fitur, tampilan, maupun sistem keamanan;</li>
                    <li>Mengubah Syarat dan Ketentuan ini sesuai kebutuhan operasional.</li>
                </ul>
                <p>Perubahan akan berlaku sejak tanggal pembaruan dokumen ini diunggah pada situs resmi ZenCom.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">8. Hukum yang Berlaku</h4>
                <p>Syarat dan Ketentuan ini diatur dan ditafsirkan berdasarkan hukum yang berlaku di Republik Indonesia. Setiap perselisihan yang timbul akan diselesaikan secara musyawarah atau melalui mekanisme hukum sesuai peraturan perundang-undangan yang berlaku.</p>
                <br>
                <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">9. Kontak</h4>
                <p>Untuk pertanyaan, saran, atau laporan pelanggaran, Pengguna dapat menghubungi kami melalui: 📩 bunglonsigma@gmail.com</p>
                <br>
                <p>© 2025 ZenCom. Seluruh hak cipta dilindungi undang-undang.</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://ovirqmxklhhbmxqbbxsz.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92aXJxbXhrbGhoYm14cWJieHN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5NjM0ODIsImV4cCI6MjA3NDUzOTQ4Mn0.4ipBgvya5CXAC4phkkskaxnJvFoVDsaQO0Lt0p9Rd0k';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey, {
            auth: {
                autoRefreshToken: true,
                persistSession: true,
                detectSessionInUrl: true
            }
        });

        // Global state
        let currentUser = null;
        let posts = [];
        let selectedFile = null;
        let trendingTopics = [
            { topic: '#ZenCom', count: 15420 },
            { topic: '#Mindfulness', count: 8932 },
            { topic: '#Meditasi', count: 5678 },
            { topic: '#Keseimbangan', count: 3456 },
            { topic: '#InnerPeace', count: 2345 }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            await loadPosts();
            loadTrendingTopics();
            loadSuggestedUsers();
            
            // Set up real-time subscriptions
            setupRealtimeSubscriptions();
        });

        // Authentication functions
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                currentUser = user;
                updateUserUI();
                loadUserData();
            }
        }

        function toggleAuth() {
            const modal = document.getElementById('authModal');
            modal.classList.toggle('active');
        }

        function toggleTermsModal() {
            const modal = document.getElementById('termsModal');
            modal.classList.toggle('active');
        }

        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('Mohon isi semua field', 'error');
                return;
            }
            
            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });
            
            if (error) {
                showNotification('Login gagal: ' + error.message, 'error');
            } else {
                currentUser = data.user;
                updateUserUI();
                loadUserData();
                toggleAuth();
                showNotification('Selamat datang di ZenCom! 🧘‍♀️');
            }
        }

        async function loginWithGitHub() {
            const { data, error } = await supabase.auth.signInWithOAuth({
                provider: 'github'
            });

            if (error) {
                showNotification('Gagal masuk dengan GitHub: ' + error.message, 'error');
            }
        }

        async function register() {
            const name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const termsCheckbox = document.getElementById('termsCheckbox');

            if (!termsCheckbox.checked) {
                showNotification('Anda harus menyetujui Syarat dan Ketentuan untuk mendaftar.', 'error');
                return;
            }
            
            if (!name || !username || !email || !password) {
                showNotification('Mohon isi semua field', 'error');
                return;
            }
            
            try {
                // Register user
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password
                });
                
                if (error) throw error;
                
                const avatarUrl = createAvatarPlaceholder(name);

                // Create user profile
                const { error: profileError } = await supabase.from('profiles').insert([
                    {
                        id: data.user.id,
                        name: name,
                        username: username,
                        avatar_url: avatarUrl
                    }
                ]);
                
                if (profileError) throw profileError;
                
                // Log in the user directly after registration
                currentUser = data.user;
                updateUserUI();
                loadUserData();
                toggleAuth();
                showNotification('Registrasi berhasil! Selamat datang di ZenCom! 🧘‍♀️');
            } catch (error) {
                showNotification('Registrasi gagal: ' + error.message, 'error');
            }
        }

        async function logout() {
            await supabase.auth.signOut();
            currentUser = null;
            updateUserUI();
            showNotification('Anda telah keluar. Sampai jumpa! 👋');
        }

        function updateUserUI() {
            const authBtn = document.getElementById('authBtn');
            const userCard = document.getElementById('userCard');
            const createPostSection = document.getElementById('createPostSection');
            
            if (currentUser) {
                authBtn.textContent = 'Keluar';
                authBtn.onclick = logout;
                userCard.style.display = 'block';
                createPostSection.style.display = 'block';
            } else {
                authBtn.textContent = 'Masuk';
                authBtn.onclick = toggleAuth;
                userCard.style.display = 'none';
                createPostSection.style.display = 'none';
            }
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            let { data: profile, error } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();
            
            if (error) {
                console.error('Error loading user data:', error);
                return;
            }
            
            if (profile) {
                if (profile.avatar_url.includes('picsum.photos')) {
                    const newAvatarUrl = createAvatarPlaceholder(profile.name);
                    const { data: updatedProfile, error: updateError } = await supabase
                        .from('profiles')
                        .update({ avatar_url: newAvatarUrl })
                        .eq('id', currentUser.id)
                        .select()
                        .single();

                    if (updateError) {
                        console.error('Error updating avatar:', updateError);
                    } else {
                        profile = updatedProfile;
                    }
                }

                document.getElementById('userName').textContent = profile.name;
                document.getElementById('userHandle').textContent = '@' + profile.username;
                document.getElementById('userAvatar').src = profile.avatar_url;
                document.getElementById('currentUserAvatar').src = profile.avatar_url;
                document.getElementById('userFollowing').textContent = profile.following_count || 0;
                document.getElementById('userFollowers').textContent = profile.followers_count || 0;
                
                // Load post count
                const { count } = await supabase
                    .from('posts')
                    .select('*', { count: 'exact', head: true })
                    .eq('user_id', currentUser.id);
                
                document.getElementById('userPosts').textContent = count || 0;
            }
        }

        // Post functions
        function handleImageSelection(event) {
            const file = event.target.files[0];
            if (!file) {
                selectedFile = null;
                document.getElementById('imagePreview').classList.add('hidden');
                return;
            }
            selectedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById('imagePreview');
                preview.src = e.target.result;
                preview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        async function uploadImage(file) {
            if (!file) return null;

            const fileName = `${currentUser.id}/${Date.now()}-${file.name}`;
            const { data, error } = await supabase.storage
                .from('post-images')
                .upload(fileName, file);

            if (error) {
                console.error('Error uploading image:', error);
                showNotification('Gagal mengunggah gambar: ' + error.message, 'error');
                return null;
            }

            const { data: { publicUrl } } = supabase.storage
                .from('post-images')
                .getPublicUrl(data.path);

            return publicUrl;
        }

        async function createPost() {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            
            const content = document.getElementById('postContent').value.trim();
            if (!content && !selectedFile) {
                showNotification('Mohon tulis zen atau pilih gambar', 'error');
                return;
            }
            
            try {
                let imageUrl = null;
                if (selectedFile) {
                    imageUrl = await uploadImage(selectedFile);
                    if (!imageUrl) return; // Upload failed
                }

                const { data, error } = await supabase
                    .from('posts')
                    .insert([
                        {
                            user_id: currentUser.id,
                            content: content,
                            image_url: imageUrl
                        }
                    ])
                    .select()
                    .single();
                
                if (error) throw error;
                
                // Reset form
                document.getElementById('postContent').value = '';
                document.getElementById('imageUpload').value = '';
                selectedFile = null;
                const preview = document.getElementById('imagePreview');
                preview.src = '';
                preview.classList.add('hidden');

                await loadPosts();
                showNotification('Zen Anda telah dibagikan! ✨');
            } catch (error) {
                showNotification('Gagal membuat zen: ' + error.message, 'error');
            }
        }

        async function loadPosts() {
            try {
                const { data, error } = await supabase
                    .from('posts')
                    .select(`
                        *,
                        profiles!posts_user_id_fkey (*),
                        likes (count),
                        comments (count)
                    `)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                posts = data || [];
                renderPosts();
            } catch (error) {
                console.error('Error loading posts:', error);
                showNotification('Gagal memuat zen', 'error');
            }
        }

        function renderPosts(postsToRender = posts) {
            const feed = document.getElementById('postsFeed');
            feed.innerHTML = '';
            
            const searchInput = document.getElementById('searchInput');
            const isSearching = searchInput && searchInput.value.length > 0;

            if (postsToRender.length === 0) {
                const message = isSearching
                    ? 'Tidak ada hasil pencarian ditemukan. Coba kata kunci lain. 🧐'
                    : 'Belum ada zen. Jadilah yang pertama berbagi! 🌸';

                const icon = isSearching ? 'fa-search' : 'fa-spa';

                feed.innerHTML = `
                    <div style="text-align: center; padding: 3rem 0;">
                        <i class="fas ${icon}" style="font-size: 4rem; color: #d1d5db; margin-bottom: 1rem;"></i>
                        <p style="color: #6b7280; font-size: 1.125rem;">${message}</p>
                    </div>
                `;
                return;
            }
            
            postsToRender.forEach(post => {
                const postElement = createPostElement(post);
                feed.appendChild(postElement);
            });
        }

        function createPostElement(post) {
            const div = document.createElement('div');
            div.className = 'zen-card';
            div.id = `post-${post.id}`; // Add unique ID to the post card
            
            const timeAgo = getTimeAgo(new Date(post.created_at));
            const isLiked = post.likes && post.likes.some(like => like.user_id === currentUser?.id);
            
            div.innerHTML = `
                <div class="post-header">
                    <img src="${post.profiles.avatar_url}" alt="${post.profiles.name}" class="post-avatar-large" onclick="showUserProfile('${post.profiles.id}')">
                    <div class="post-meta">
                        <div class="post-meta-header">
                            <div class="post-user-info">
                                <h4 class="post-username" onclick="showUserProfile('${post.profiles.id}')">${post.profiles.name}</h4>
                                <span class="post-tag">@${post.profiles.username}</span>
                                <span class="post-time">${timeAgo}</span>
                            </div>
                            <button class="close-button">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                        <p class="post-content">${post.content}</p>
                        ${
                            post.image_url ?
                            `<img src="${post.image_url}" alt="Post image" style="width: 100%; border-radius: 0.75rem; margin-top: 1rem; cursor: pointer;" onclick="showImageDetail('${post.image_url}')">`
                            : ''
                        }
                        <div class="post-footer">
                            <button onclick="showComments('${post.id}')" class="post-action">
                                <i class="far fa-comment action-icon"></i>
                                <span class="action-count">${post.comments?.[0]?.count || 0}</span>
                            </button>
                            <button onclick="toggleLike('${post.id}')" class="post-action ${isLiked ? 'liked' : ''}">
                                <i class="${isLiked ? 'fas' : 'far'} fa-heart action-icon"></i>
                                <span class="action-count">${post.likes?.[0]?.count || 0}</span>
                            </button>
                            <div class="post-action" style="position: relative;">
                                <button onclick="toggleShareMenu('${post.id}')" class="post-action" style="padding: 0; background: transparent;">
                                    <i class="fas fa-share action-icon"></i>
                                    <span class="action-count">Bagikan</span>
                                </button>
                                <div id="share-menu-${post.id}" class="hidden" style="position: absolute; bottom: 100%; left: 0; background: white; border-radius: 0.75rem; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 10; width: 200px; overflow: hidden;">
                                    ${post.image_url ? `<div class="share-option" onclick="downloadImage('${post.image_url}', 'zencom-post-${post.id}.jpg')"><i class="fas fa-download" style="margin-right: 0.5rem;"></i>Download foto</div>` : ''}
                                    <div class="share-option" onclick="sharePostLink('${post.id}')"><i class="fas fa-link" style="margin-right: 0.5rem;"></i>Bagikan Tautan Postingan</div>
                                </div>
                            </div>
                            <button class="post-action">
                                <i class="far fa-bookmark action-icon"></i>
                                <span class="action-count">Simpan</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            return div;
        }

        async function toggleLike(postId) {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            
            try {
                // Check if already liked
                const { data: existingLike } = await supabase
                    .from('likes')
                    .select('*')
                    .eq('post_id', postId)
                    .eq('user_id', currentUser.id)
                    .single();
                
                if (existingLike) {
                    // Unlike
                    await supabase
                        .from('likes')
                        .delete()
                        .eq('id', existingLike.id);
                } else {
                    // Like
                    await supabase
                        .from('likes')
                        .insert([
                            {
                                post_id: postId,
                                user_id: currentUser.id
                            }
                        ]);
                }
                
                await loadPosts();
            } catch (error) {
                showNotification('Gagal menyukai zen: ' + error.message, 'error');
            }
        }

        function toggleShareMenu(postId) {
            const menu = document.getElementById(`share-menu-${postId}`);
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }

        async function downloadImage(imageUrl, fileName) {
            try {
                // To bypass CORS issues, we fetch the image via a server-side proxy if needed,
                // but for Supabase Storage, direct fetch should work if configured correctly.
                // Let's try a direct fetch first.
                const response = await fetch(imageUrl);
                if (!response.ok) throw new Error('Network response was not ok.');
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                showNotification('Gambar berhasil diunduh! 🖼️');
            } catch (error) {
                console.error('Download error:', error);
                showNotification('Gagal mengunduh gambar. Coba klik kanan dan "Simpan Gambar Sebagai...".', 'error');
            }
        }

        function sharePostLink(postId) {
            const url = `${window.location.origin}${window.location.pathname}#post-${postId}`;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('Tautan postingan disalin ke clipboard! 🔗');
            }, (err) => {
                console.error('Could not copy text: ', err);
                showNotification('Gagal menyalin tautan.', 'error');
            });
        }

        // Navigation functions
        function showFeed() {
            document.getElementById('feedTitle').textContent = 'Beranda';
            loadPosts();
        }

        function showExplore() {
            document.getElementById('feedTitle').textContent = 'Jelajahi';
            // Load explore content
        }

        function showNotifications() {
            document.getElementById('feedTitle').textContent = 'Notifikasi';
            // Load notifications
        }

        function showMessages() {
            document.getElementById('feedTitle').textContent = 'Pesan';
            // Load messages
        }

        function showProfile() {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            showUserProfile(currentUser.id);
        }

        function showCreatePost() {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            document.getElementById('postContent').focus();
        }

        function showSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.focus();
            }
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();

            if (query.length === 0) {
                renderPosts(posts);
                return;
            }

            const filteredPosts = posts.filter(post => {
                const contentMatch = post.content.toLowerCase().includes(query);
                const usernameMatch = post.profiles.username.toLowerCase().includes(query);
                const nameMatch = post.profiles.name.toLowerCase().includes(query);
                return contentMatch || usernameMatch || nameMatch;
            });

            renderPosts(filteredPosts);
        }

        function createAvatarPlaceholder(name) {
            const getInitials = (name) => {
                const names = name.split(' ');
                let initials = names[0].substring(0, 1).toUpperCase();
                if (names.length > 1) {
                    initials += names[names.length - 1].substring(0, 1).toUpperCase();
                }
                return initials;
            };

            const initials = getInitials(name);
            const width = 200;
            const height = 200;
            const backgroundColor = `
                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:rgb(102,126,234);stop-opacity:1" />
                    <stop offset="100%" style="stop-color:rgb(118,75,162);stop-opacity:1" />
                </linearGradient>
            `;

            const svg = `
                <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
                    <defs>${backgroundColor}</defs>
                    <rect width="100%" height="100%" fill="url(#grad1)"/>
                    <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="white" font-size="80" font-family="Arial, sans-serif" font-weight="bold">
                        ${initials}
                    </text>
                </svg>
            `;

            return `data:image/svg+xml;base64,${btoa(svg)}`;
        }

        // Utility functions
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'baru saja';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'j';
            if (seconds < 2592000) return Math.floor(seconds / 86400) + 'h';
            if (seconds < 31536000) return Math.floor(seconds / 2592000) + 'b';
            return Math.floor(seconds / 31536000) + 't';
        }

        function showNotification(message, type = 'success') {
            const toast = document.getElementById('notificationToast');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            toast.classList.add('active');
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // Load trending topics
        function loadTrendingTopics() {
            const trendingList = document.getElementById('trendingList');
            trendingList.innerHTML = '';
            
            trendingTopics.forEach(topic => {
                const div = document.createElement('div');
                div.className = 'trending-item';
                div.innerHTML = `
                    <p class="trending-topic">${topic.topic}</p>
                    <p class="trending-count">${topic.count.toLocaleString()} zen</p>
                `;
                trendingList.appendChild(div);
            });
        }

        // Load suggested users
        async function loadSuggestedUsers() {
            try {
                const { data: users, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .limit(5);
                
                if (error) throw error;
                
                const suggestedUsers = document.getElementById('suggestedUsers');
                suggestedUsers.innerHTML = '';
                
                if (users) {
                    users.forEach(user => {
                        const div = document.createElement('div');
                        div.className = 'user-suggestion';
                        div.innerHTML = `
                            <div class="suggested-user">
                                <div class="user-suggestion-info">
                                    <img src="${user.avatar_url}" alt="${user.name}" class="suggestion-avatar">
                                    <div class="suggestion-details">
                                        <h5>${user.name}</h5>
                                        <p>@${user.username}</p>
                                    </div>
                                </div>
                                <button onclick="followUser('${user.id}')" class="zen-button" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
                                    Ikuti
                                </button>
                            </div>
                        `;
                        suggestedUsers.appendChild(div);
                    });
                }
            } catch (error) {
                console.error('Error loading suggested users:', error);
            }
        }

        async function followUser(userId) {
            if (!currentUser) {
                toggleAuth();
                return;
            }
            
            try {
                // Implement follow functionality
                showNotification('Mengikuti pengguna...');
            } catch (error) {
                showNotification('Gagal mengikuti pengguna', 'error');
            }
        }

        function showUserProfile(userId) {
            // Show user profile
            document.getElementById('feedTitle').textContent = 'Profil Zen Master';
        }

        function showComments(postId) {
            // Show comments for post
            showPostDetail(postId);
        }

        function showPostDetail(postId) {
            const modal = document.getElementById('postDetailModal');
            const content = document.getElementById('postDetailContent');
            
            // Find post
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            content.innerHTML = `
                <div class="zen-card">
                    <div class="post-header">
                        <img src="${post.profiles.avatar_url}" alt="${post.profiles.name}" class="post-avatar-large">
                        <div class="post-meta">
                            <div class="post-meta-header">
                                <div class="post-user-info">
                                    <h4 class="post-username">${post.profiles.name}</h4>
                                    <span class="post-tag">@${post.profiles.username}</span>
                                    <span class="post-time">${getTimeAgo(new Date(post.created_at))}</span>
                                </div>
                            </div>
                            <p class="post-content">${post.content}</p>
                            ${
                                post.image_url ?
                                `<img src="${post.image_url}" alt="Post image" style="width: 100%; border-radius: 0.75rem; margin-top: 1rem;">`
                                : ''
                            }
                            <div class="post-footer">
                                <button class="post-action">
                                    <i class="far fa-comment action-icon"></i>
                                    <span class="action-count">${post.comments?.[0]?.count || 0}</span>
                                </button>
                                <button class="post-action">
                                    <i class="far fa-heart action-icon"></i>
                                    <span class="action-count">${post.likes?.[0]?.count || 0}</span>
                                </button>
                                <button class="post-action">
                                    <i class="fas fa-share action-icon"></i>
                                    <span class="action-count">Bagikan</span>
                                </button>
                                <button class="post-action">
                                    <i class="far fa-bookmark action-icon"></i>
                                    <span class="action-count">Simpan</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 1.5rem;">
                    <h3 class="section-title">Komentar Zen</h3>
                    <div class="zen-card">
                        <div class="post-form">
                            <img src="${currentUser ? document.getElementById('currentUserAvatar').src : createAvatarPlaceholder('?')}" alt="User" class="post-avatar">
                            <div class="post-input-container">
                                <textarea placeholder="Tulis komentar zen..." class="post-textarea" rows="3"></textarea>
                                <button class="zen-button" style="margin-top: 0.75rem;">
                                    <i class="fas fa-paper-plane mr-2"></i>Kirim
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function closePostDetail() {
            document.getElementById('postDetailModal').classList.remove('active');
        }

        function showImageDetail(imageUrl) {
            document.getElementById('imageDetailContent').src = imageUrl;
            document.getElementById('imageDetailModal').classList.add('active');
        }

        function closeImageDetail() {
            document.getElementById('imageDetailModal').classList.remove('active');
        }

        // Real-time subscriptions
        function setupRealtimeSubscriptions() {
            // Subscribe to new posts
            supabase
                .channel('posts')
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'posts' }, payload => {
                    loadPosts();
                })
                .subscribe();
            
            // Subscribe to likes
            supabase
                .channel('likes')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'likes' }, payload => {
                    loadPosts();
                })
                .subscribe();
        }
    </script>
</body>
</html>
